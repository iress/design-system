import { Meta } from '@storybook/addon-docs/blocks';
import {
  ComponentOverview,
  ComponentExample,
} from '@iress-storybook/components';
import * as ComponentStories from './Filter.stories';

<Meta of={ComponentStories} />

# Filter

<ComponentOverview
  description="A filter allows you to pick one or more options from a list (that may be searchable) and is triggered by an activator button."
  story={ComponentStories.Default}
  stories={ComponentStories}
/>

## Usage

The `IressFilter` component has been built to be flexible enough to cover most application needs, allowing a user to add or remove data items from a displayed data set.

This component is not designed to be used within forms and should be used to provide instant updates to rendered data. Instead, in forms, you should use components like `IressSelect`, `IressCombobox` and `IressCheckboxGroup`.

Here is an example using multiple `IressFilter`s to filter an `IressTable`.

<ComponentExample
  story={ComponentStories.SearchTable}
  stories={ComponentStories}
/>

### Label

The `label` prop is required for the filter to be displayed. It is used to describe the filter to the user.

When the filter has selected options, it will append the label of the first option, or the number of selected options if `multiSelect` is true and there is more than one item selected.

<ComponentExample story={ComponentStories.Label} stories={ComponentStories} />

### Uncontrolled

The `defaultValue` prop can be used to set the initial value of the combobox. The value will be managed by the component.

**Note:** The `defaultValue` prop is not checked against the options provided, allowing it to work with asynchronous options.

<ComponentExample
  story={ComponentStories.Uncontrolled}
  stories={ComponentStories}
/>

### Controlled

The `value` prop can be used to completely control the state of the component. Use the `onChange` and `onReset` props to sync your state with the component.

**Note:** The `value` prop is not checked against the options provided, allowing it to work with asynchronous options.

<ComponentExample
  story={ComponentStories.Controlled}
  stories={ComponentStories}
/>

### Multiple selection

Using the `multiSelect` prop, the `IressFilter` will allow the user to make multiple selections.

<ComponentExample
  story={ComponentStories.MultiSelect}
  stories={ComponentStories}
/>

### Providing options

#### `options`

The `options` prop is required for the combobox. You can provide an array of `LabelValueMeta[]` objects to the `options` prop. Filtering is done based on the `label` property.

<ComponentExample story={ComponentStories.Options} stories={ComponentStories} />

#### Asynchronous `options`

If you would like to render suggestions from the server, you can pass a function to the `options` prop. It accepts a string parameter and returns a promise that resolves to an array of `LabelValueMeta[]` objects. No filtering is done for asynchronous options, you must filter the options yourself using the query.

**Note:** Asynchronous `options` will automatically set the `searchable` prop to true.

<ComponentExample
  story={ComponentStories.AsyncOptions}
  stories={ComponentStories}
/>

#### `initialOptions`

If you want to provide initial options to the user, you can use the `initialOptions` prop. This is useful when you want to provide a list of options to the user before they start typing (eg. recommended search terms).

**Note:** `initialOptions` only works if `searchable` is true.

<ComponentExample
  story={ComponentStories.InitialOptions}
  stories={ComponentStories}
/>

### Complex Options

The options prop also accepts further properties for each option. This is useful for displaying other data that compliments the main label.

- append: accepts a ReactNode to append to the end of the option, usually a badge.
- meta: accepts a ReactNode to display additional information about the option.
- prepend: accepts a ReactNode to add to the start of the option, usually an icon.

All `IressFilter`s accept meta as an attribute in the option array.

<ComponentExample
  story={ComponentStories.ComplexOptions}
  stories={ComponentStories}
/>

## Behaviour

- When the activator is tapped, the filter will open
- Up and Down Arrow keys are used to navigate the options
- When focus is on the search input:
  - Pressing the down key will move focus to the first menu item
  - If `visibleResetButton` is set to true, pressing the down key will focus the reset button instead
- When focus is on the reset button:
  - Pressing the down key will move focus to the first menu item
- Pressing the Space or Enter keys when focussed on an option will select it
- Pressing the Escape key will close the filter and place focus back on to the activator button

## Examples

### Input props

You can customise some settings of the query input by setting the `inputProps`.

It does have some defaults to help with user experience. `prepend` automatically has a search icon, and `clearable` is set to true by default.

<ComponentExample
  story={ComponentStories.InputProps}
  stories={ComponentStories}
/>

### Searchable

When an `IressFilter` has 10 or more options, it is recommended that you enable the search functionality. This can be done by adding the `searchable` prop.

**Note:** When using asynchronous options, the `searchable` prop is automatically set to true.

<ComponentExample
  story={ComponentStories.Searchable}
  stories={ComponentStories}
/>

### Reset filters

Adding the `visibleResetButton` prop adds a way for the user a way to easily reset their choices. This works for single and multiple selection filters.

Below are examples of both single selects and multi selects with `visibleResetButton` enabled.

<ComponentExample
  story={ComponentStories.ResetFilters}
  stories={ComponentStories}
/>

### No results

If you would like to show a message when there are no results, you can use the `searchNoResultsText` prop. It accepts any React node.

<ComponentExample
  story={ComponentStories.NoResultsText}
  stories={ComponentStories}
/>

### Popover props

Under the hood, filter uses `IressPopover` to display the filter options. You can customise this with `popoverProps`. It accepts `align`, `className`, `container` and `displayMode`.

There are two additional props that filter accepts to customise the popover: `header` and `footer`. You can place additional content above or below the results using these props.

<ComponentExample
  story={ComponentStories.PopoverProps}
  stories={ComponentStories}
/>

### Selected options text

In `multiSelect` mode, the selections options are displayed using the `selectedOptionsText` prop. You can customise this text to suit your needs. It will replace `{{numOptions}}` with the number of selected options.

<ComponentExample
  story={ComponentStories.SelectedOptionsText}
  stories={ComponentStories}
/>
